local Http = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

local Fluent = loadstring(game:HttpGet("https://raw.githubusercontent.com/Boorkod/Infernox/refs/heads/main/Folders/UI/GuI-FLueNtUIiNFeRNoXHuB-VerSiOn001TeSt10%25100%25.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local MapName = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name
local MainFolder = "InfernoX Hub"
local GameFolder = MainFolder.."/"..MapName
local UserFile = GameFolder.."/"..LocalPlayer.UserId..".json"
local AutoloadFile = GameFolder.."/Autoload.txt"

local function MakeFolderSafe(path)
	if not isfolder(path) then
		makefolder(path)
	end
end

local function MakeFileSafe(path, content)
	if not isfile(path) then
		writefile(path, content)
	end
end

MakeFolderSafe(MainFolder)
MakeFolderSafe(GameFolder)
MakeFileSafe(UserFile, "{}")
MakeFileSafe(AutoloadFile, "")

local ConfigData = {}
pcall(function()
	ConfigData = Http:JSONDecode(readfile(UserFile))
end)

-- ========================
-- Create Window & Tabs (ต้องมาก่อน)
-- ========================
local Window = Fluent:CreateWindow({
	Title = "Team2"..Fluent.Version,
	SubTitle = "by Everyone",
	TabWidth = 140,
	Size = UDim2.fromOffset(520,380),
	Acrylic = true,
	Theme = "Darker",
	MinimizeKey = nil
})

local T = {
	M = Window:AddTab({Title="Main"}),
	Settings = Window:AddTab({Title="Settings"})
}

-- ========================
-- IMAGE BUTTON (FIX ALL)
-- ========================
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

if PlayerGui:FindFirstChild("MyImageButtonGui") then
	PlayerGui.MyImageButtonGui:Destroy()
end

local G = Instance.new("ScreenGui")
G.Name = "MyImageButtonGui"
G.ResetOnSpawn = false
G.IgnoreGuiInset = true
G.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
G.Parent = PlayerGui

local B = Instance.new("ImageButton")
B.Parent = G
B.Size = UDim2.new(0,50,0,50)
B.Position = UDim2.new(0.12,0,0.200,0)
B.Image = "rbxassetid://133128937209520"
B.BackgroundTransparency = 1
B.ZIndex = 999
Instance.new("UICorner", B).CornerRadius = UDim.new(0,10)

local TS = game:GetService("TweenService")

B.MouseButton1Down:Connect(function()
	TS:Create(B, TweenInfo.new(0.08), {Size = UDim2.new(0,45,0,45)}):Play()
	task.wait(0.08)
	TS:Create(B, TweenInfo.new(0.08), {Size = UDim2.new(0,50,0,50)}):Play()
end)

-- เปิด / ปิด Fluent (ถูกต้อง 100%)
B.MouseButton1Click:Connect(function()
	Window:Minimize()
end)

-- ========================
-- Example UI Elements
-- ========================
local Toggle = T.M:AddToggle("MyToggle", {Title = "Toggle", Default = false })

    Toggle:OnChanged(function()
    print("Toggle changed:", Toggle.Value)
end)


    
    local Slider = T.M:AddSlider("Slider", {
        Title = "Slider",
        Description = "This is a slider",
        Default = 2,
        Min = 0,
        Max = 5,
        Rounding = 1,
        Callback = function(Value)
            print("Slider was changed:", Value)
        end
    })

    Slider:OnChanged(function(Value)
        print("Slider changed:", Value)
    end)

    Slider:SetValue(3)



    local Dropdown = T.M:AddDropdown("Dropdown", {
        Title = "Dropdown",
        Values = {"one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen"},
        Multi = false,
        Default = 1,
    })

    Dropdown:SetValue("four")

    Dropdown:OnChanged(function(Value)
        print("Dropdown changed:", Value)
    end)


    
    local MultiDropdown = T.M:AddDropdown("MultiDropdown", {
        Title = "Dropdown",
        Description = "You can select multiple values.",
        Values = {"one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen"},
        Multi = true,
        Default = {"seven", "twelve"},
    })

    MultiDropdown:SetValue({
        three = true,
        five = true,
        seven = false
    })

    MultiDropdown:OnChanged(function(Value)
        local Values = {}
        for Value, State in next, Value do
            table.insert(Values, Value)
        end
        print("Mutlidropdown changed:", table.concat(Values, ", "))
    end)

local function R(list)
	for id, Element in pairs(list) do
		if Element then
			if ConfigData[id] ~= nil then
				Element:SetValue(ConfigData[id])
			end
			Element:OnChanged(function(v)
				ConfigData[id] = v
				writefile(UserFile, Http:JSONEncode(ConfigData))
			end)
		end
	end
end

R({
	MyToggle = Toggle,
	MySlider = Slider,
	MyDropdown = Dropdown,
	MyInput = Input,
	MyKeybind = Keybind,
})

SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
InterfaceManager:SetFolder(GameFolder)
SaveManager:SetFolder(GameFolder)
InterfaceManager:BuildInterfaceSection(T.Settings)
SaveManager:BuildConfigSection(T.Settings)
SaveManager:LoadAutoloadConfig()

Window:SelectTab(1)
Fluent:Notify({Title="Fluent", Content="The script has been loaded.", Duration=8})
